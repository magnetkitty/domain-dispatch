<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>磁力猫最新地址</title>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 20px;
        }

        .container {
            background: #fff;
            border-radius: 18px;
            padding: 30px;
            max-width: 900px;
            margin: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        .header h1 {
            font-size: 2.4em;
            font-weight: 700;
            color: #2c3e50;
        }

        .domain-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 18px;
            margin-top: 15px;
        }

        .domain-item {
            background: #fff;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 18px;
            position: relative;
            transition: 0.25s;
            cursor: pointer;
        }

        .domain-item:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .domain-url {
            font-weight: 600;
            color: #2c3e50;
            word-break: break-all;
        }

        .status-label {
            margin-top: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #666;
        }

        .status-ok {
            color: #27ae60;
        }

        .status-bad {
            color: #e74c3c;
        }

        .status-test {
            color: #f39c12;
        }

        .copy-btn {
            margin-top: 10px;
            background: #3498db;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            border: none;
        }

        .copy-btn:hover {
            background: #2980b9;
        }

        .counter {
            margin-top: 8px;
            font-size: 12px;
            color: #7f8c8d;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>磁力猫最新地址</h1>
        </div>

        <div id="sectionsContainer"></div>
        发邮件到<span style="font-weight:bolder">magnetkitty.com@gmail.com</span>获取最新地址<br/>
        推荐使用<a href="https://www.microsoft.com/zh-cn/edge/download?form=MA13FJ" target="_blank" style="font-weight: bolder;">微软Edge浏览器</a>、<a href="https://www.google.cn/chrome/" target="_blank" style="font-weight: bolder;">谷歌Chrome浏览器</a>访问本站,本站已适配手机浏览。
    </div>

    <script>
        /* --------------------  本地计数存储 -------------------- */
        function increaseVisitCount(domain) {
            let map = JSON.parse(localStorage.getItem("visitCount") || "{}");
            map[domain] = (map[domain] || 0) + 1;
            localStorage.setItem("visitCount", JSON.stringify(map));
        }
        function getVisitCount(domain) {
            let map = JSON.parse(localStorage.getItem("visitCount") || "{}");
            return map[domain] || 0;
        }

        /* -------------------- HTTP 可用性检测 -------------------- */
        async function checkDomain(domain, el) {
            el.innerText = "检测中...";
            el.className = "status-label status-test";
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 4000);

                const res = await fetch("https://" + domain, { mode: "no-cors", signal: controller.signal });
                el.innerText = "可访问";
                el.className = "status-label status-ok";
            } catch (e) {
                el.innerText = "不可访问";
                el.className = "status-label status-bad";
            }
        }

        function copyAndOpen(domain) {
            navigator.clipboard.writeText(domain);
            increaseVisitCount(domain);
            window.open("https://" + domain, "_blank");
        }

        function renderDomains(list) {
            const container = document.getElementById("sectionsContainer");
            container.innerHTML = "";

            const section = document.createElement("div");
            section.innerHTML = `<h2>最新域名列表</h2>`;

            const grid = document.createElement("div");
            grid.className = "domain-list";

            list.forEach(domain => {
                const item = document.createElement("div");
                item.className = "domain-item";

                item.innerHTML = `
            <div class="domain-url">${domain}</div>
            <div class="status-label" id="check-${domain}">等待检测...</div>
            <button class="copy-btn">复制并访问</button>
            <div class="counter">访问次数：${getVisitCount(domain)}</div>
        `;

                const btn = item.querySelector(".copy-btn");
                btn.onclick = () => copyAndOpen(domain);

                grid.appendChild(item);

                // 延迟检测（避免同时请求太多）
                setTimeout(() => {
                    checkDomain(domain, document.getElementById(`check-${domain}`));
                }, Math.random() * 500);
            });

            section.appendChild(grid);
            container.appendChild(section);
        }

        /* -------------------- 示例域名（接入 API 可替换） -------------------- */
       /* ==============================
   多线路自动获取最新域名（最终版）
   ============================== */

const API_ENDPOINTS = [

    "https://domain.magnetkitty.online/domain.json",
    "https://cdn.jsdelivr.net/gh/magnetkitty/domain-dispatch/domain.json",
    "https://raw.githubusercontent.com/magnetkitty/domain-dispatch/main/domain.json"
];

/* Skeleton 骨架屏（你原来页面已经有 showSkeleton，只保留即可） */
function showSkeleton(){
  const container=document.getElementById('sectionsContainer');
  container.innerHTML='<div class="domain-list">'+Array(4).fill(
      `<div class="domain-item" style="animation:pulse 1.5s infinite;background:rgba(255,255,255,.6)">
        <div style="width:70%;height:18px;background:#ddd;border-radius:6px;margin-bottom:14px"></div>
        <div style="width:40%;height:14px;background:#e5e5e5;border-radius:6px"></div>
      </div>`
  ).join('')+'</div>';
}

function showFetchError(msg){
    renderDomains([]); 
    document.getElementById("sectionsContainer").innerHTML =
        `<div style="padding:20px;color:red;text-align:center;">${msg}</div>`;
}

/* 主函数：自动轮询线路 */
async function fetchRealDomains() {
    showSkeleton();

    for (let url of API_ENDPOINTS) {
        try {
            console.log("尝试获取:", url);

            let res = await fetch(url, { cache: "no-store" });
            let data = await res.json();

            // 验证 JSON 结构是否合法
            if (data && data.domains && Array.isArray(data.domains)) {

                // 解析 JSON → 扁平化域名数组
                let flat = [];
                data.domains
                    .sort((a, b) => (a.priority || 999) - (b.priority || 999)) // 按优先级排序
                    .forEach(group => {
                        if (group.domains) flat.push(...group.domains);
                    });

                // 去重
                flat = [...new Set(flat)];

                // 交给你现有的 UI 渲染逻辑
                renderDomains(flat);

                console.log("成功获取地址来自:", url);

                return; // 获取成功退出
            }
        } catch (err) {
            console.warn("线路失败:", url, err);
            continue; 
        }
    }

    // 所有线路失败
    showFetchError("所有线路均无法获取域名，请稍后再试");
}

/* 页面加载后自动执行 */
fetchRealDomains();
 

    </script>
</body>

</html>